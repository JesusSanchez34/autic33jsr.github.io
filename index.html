<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Autenticación</title>
    <link rel="stylesheet" href="estilos.css">
  </head>
  <body>
    <h1>Autenticación</h1>
    <h1>Sesión</h1>
    <fieldset>
      <legend>Email</legend>
      <output id="email"><progress max="100">Cargando…</progress></output>
    </fieldset>
    <fieldset>
      <legend>Nombre</legend>
      <output id="nombre"></output>
    </fieldset>
    <figure><img id="avatar" alt="Avatar"></figure>
    <button type="button" onclick="terminaSesión()">Terminar Sesión</button>
    <footer>&copy; 2023 Ricardo Armando Machorro Reyes.</footer>

    <!-- Agrega los scripts de Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
      //@ts-check

      // Configura tu proyecto de Firebase
      const firebaseConfig = {
        apiKey: "TU_API_KEY",
        authDomain: "TU_DOMINIO_AUTH.firebaseapp.com",
        projectId: "TU_ID_PROYECTO",
        storageBucket: "TU_BUCKET.appspot.com",
        messagingSenderId: "TU_SENDER_ID",
        appId: "TU_APP_ID",
        measurementId: "TU_MEASUREMENT_ID"
      };

      // Inicializa Firebase
      firebase.initializeApp(firebaseConfig);

      // Obtiene una referencia al servicio de autenticación de Firebase
      const auth = firebase.auth();

      // Configura el proveedor de autenticación con Google
      const provider = new firebase.auth.GoogleAuthProvider();
      provider.setCustomParameters({ prompt: "select_account" });

      // Manejador de cambios en el estado de autenticación
      auth.onAuthStateChanged((usuarioAuth) => {
        if (usuarioAuth && usuarioAuth.email) {
          // Usuario autenticado
          document.getElementById("email").textContent = usuarioAuth.email;
          document.getElementById("nombre").textContent = usuarioAuth.displayName;
          document.getElementById("avatar").src = usuarioAuth.photoURL;
        } else {
          // No ha iniciado sesión. Redirige al usuario para iniciar sesión con Google
          auth.signInWithRedirect(provider);
        }
      });

      // Termina la sesión del usuario
      async function terminaSesión() {
        try {
          await auth.signOut();
        } catch (e) {
          console.log(e);
        }
      }
    </script>
  </body>
</html>
